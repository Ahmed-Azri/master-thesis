\section{Openflow}



\subsection{Definição}

Em 2008 o protocolo OpenFlow foi publicado. Ele permitiu que pesquisadores
pudessem criar experimentos com novos protocolos em redes convencionais
\citep{nick2008openflow}.
O OpenFlow foi criado como um padrão aberto, o que permite que todos os 
fabricantes de equipamentos de redes possam habilitar seus produtos ao 
padrão.

O protocolo consiste em uma interface de programação para o switch. 
Assim, um programador pode, através de um programa, controlar a forma como 
um switch executa seu encaminhamento de pacotes. 
De uma maneira bem clara, o protocolo OpenFlow separa o plano de dados
do plano de controle, fazendo com que soluções SDN possam ser criadas 
e experimentadas.
Por ser uma solução de baixo custo, o OpenFlow obteve boa aceitação na 
academia e no mercado, dado o volume de empresas e pesquisas relacionadas
ou que utilizam o protocolo.

\subsection{Componentes}

Na arquitetura estabelicida pelo protocolo OpenFlow existem dois papéis
principais.
O controlador e o switch OpenFlow. 
Uma separação baseada no modelo das Redes definidas por software (SDN)
conforme pode ser visto na figura~\ref{fig:of-arch}.

\begin{figure}[h!]
    \centering
    \label{fig:of-arch}
    \includegraphics{img/openflow-architecture}
    \caption{Divisão da arquitetura OpenFlow}
\end{figure}

\subsection{Arquitetura do Switch}

O switch OpenFlow pode ser dividido em três principais partes. 
A primeira é o canal de comunicação seguro com o controlador.
A segunda é a interface do protocolo OpenFlow que permite ao controlador
controlar o switch.
A terceira é sua tabela de fluxos.

O canal de comunicação seguro tem a garantia de confiabilidade na troca 
de mensagens entre o controlador e o switch através do protocolo SSL 
(Secure Socket Layer). 
Isso adiciona proteção à rede em relação a ataques de elementos mal 
intencionados \citep{rothenberg2010openflow}.

A interface do protocolo OpenFlow é a padronização das mensagens enviadas 
pelo controlador ao switch de modo a definir o comportamento do encaminhamento
de pacotes. 
Ou seja, é o conjunto de possíveis instruções para se controlar de maneira
genérica o plano de dados de qualquer \emph{hardware} de redes habilitado 
ao padrão OpenFlow.

A tabela de fluxos é composta por regras.
Cada regra consiste em ações associadas à fluxos. 
Através dessa tabela o switch executa o encaminhamento de pacotes. 
As entradas dessa tabela são atualizadas pelo controlador.

\begin{figure}[h!]
    \centering
    \label{fig:switch-arch}
    \includegraphics[width=\linewidth]{img/switch-architecture}
    \caption{Arquitetura do switch OpenFlow}
\end{figure}


\subsection{Fluxos}

Um fluxo é a representação de um ou mais pacotes em função de suas
características.
Essas características variam de acordo com o cabeçalho OpenFlow.
Os fluxos são genéricos. 
Ao invés de analisar pacotes e portas para fazer a análise do trafego,
que representam o passado, o fluxos são a representação do futuro. 
Um fluxo pode caracterizar pacotes que ainda não passaram pelo switch mas 
que possuem as mesmas características que compõem aquele fluxo. 
Sendo assim, a ação associada ao fluxo é aplicada a esses novos pacotes.

A tabela de fluxos dentro do switch OpenFlow identifica os fluxos para que o 
plano de dados execute ações sobre os pacotes que são pertencentes àquele
fluxo. 
A tabela \ref{tbl:flowtable} apresenta de maneira simplificada a tabela 
de fluxos dentro do switch OpenFlow.

\begin{table}
    \centering
    \begin{tabular}{ | l | l | l | l |}
    \hline
    \textbf{Header} & \textbf{Counters} & \textbf{Actions} & \textbf{Priority} 
    \\ \hline in\_port=5 & 55635 bytes & \pbox{20cm}{Forward \\ port=8} 
    & 100 \\ \hline
    \pbox{20cm}{ip=192.168.1.42 \\ port=80} & 4032 bytes & \pbox{30cm}{Set 
    \\ rewrite \\ ip=192.168.1.100} & 500 \\ \hline ipproto=UDP & 100 bytes 
    & Drop & 700 \\ \hline
    \end{tabular}
    \caption{Tabela de fluxos simplificada}
    \label{tbl:flowtable}
\end{table}

\subsection{Cabeçalho}

O cabeçalho OpenFlow se estende da camada 1 até a camada 4 da pilha TCP/IP.
A figura \ref{fig:of-header} apresenta os campos e suas respectivas camadas.

\begin{figure}[h!]
    \centering
    \label{fig:of-header}
    \includegraphics[width=\linewidth]{img/openflow-header}
    \caption{Cabeçalho OpenFlow}
\end{figure}

Quando um novo pacote ingressa no switch OpenFlow esse cabeçalho é preenchido
e encaminhado para o controlador. 
Através da análise dessas informações do fluxo o controlador envia uma 
mensagem ao switch instalando/atualizando regras na tabela de fluxos. 

Esse mecanismo de rotulagem e identificação de tráfego e pacotes (fluxos) é
inspirado no MPLS (\emph{Multi-protocol Label Switching}) 
\citep{bruce2008mpls}.

\subsection{Ações}

As ações (\emph{actions}) são aplicadas aos fluxos especificados na tabela
de fluxos do switch.
Ações como encaminhamento, atualização de cabeçalho e rejeição podem ser 
aplicadas aos pacotes pertencentes àquele fluxo.

A especificação do protocolo OpenFlow \citep{ofprotocol2015} descreve todas 
as possíveis ações que podem ser aplicadas.
A lista abaixo apresenta algumas ações:

\begin{multicols}{3}
    \begin{itemize}
        \item Forwarding
        \item Drop
        \item Set
        \item Strip
        \item Copy-in
        \item Copy-out
        \item Push
        \item Pop
        \item Dec
    \end{itemize}
\end{multicols}

\subsection{Controlador}
